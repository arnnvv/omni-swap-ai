# 1. プロジェクト概要

**Prompt Fusion Swap**は、リアルタイムのポートフォリオ分析ダッシュボードと、AIを活用した自然言語コマンドインターフェースを融合させた次世代のDeFiターミナルです。ユーザーは自身の資産配分を瞬時に把握し、まるでアシスタントに話しかけるかのように、簡単かつ複雑な取引を実行できます。

## 2. ターゲットユーザー

クリック数を最小限に抑え、最大限のスピードでプロトコルと対話する、最も効率的で直感的な方法を求める、テクノロジーに精通したDeFiユーザーおよびパワーユーザー。

## 3. 主要な機能と要件

### 3.1. 機能：リアルタイム・ポートフォリオダッシュボード 📊

ユーザーが情報に基づいた意思決定を行うために必要なコンテキストを提供する、アプリケーションの視覚的な基盤です。

* **FR-1（機能要件）: ウォレット接続**
    * ユーザーはEVM互換ウォレットを接続できる必要があります。
* **FR-2: 資産と価値の表示**
    * ダッシュボードには、ユーザーが保有するすべてのトークンのリストを、その残高、現在の米ドル価格、および保有ごとの米ドル総価値とともに表示する必要があります。ポートフォリオの総価値は目立つように表示されなければなりません。
* **NFR-1（非機能要件）: パフォーマンス**
    * ウォレット接続後、すべてのポートフォリオデータは5秒以内に読み込まれる必要があります。

### 3.2. 機能：AIコマンドインターフェース 🤖

複雑なフォームを自然言語に置き換える、主要なインタラクション方法です。

* **FR-3: 自然言語入力**
    * ユーザーは専用の入力バーにコマンドを入力できる必要があります（例：「1 ETHをUSDCにスワップして」、「私のLINKの半分をDAIに売って」）。
* **FR-4: 意図の解析**
    * システムのAIバックエンドは、ユーザーの意図を解析して、目的のアクション（例：スワップ、リミットオーダー）とそのパラメータ（トークン、数量）を特定する必要があります。システムは、相対的な数量（例：「半分」、「20%」）のコンテキストとして、ライブのポートフォリオデータを使用する必要があります。
* **FR-5: ユーザー確認**
    * トランザクションを生成する前に、システムは明確で人間が読める確認メッセージをユーザーに提示する必要があります（例：「1.5 WETHを3,000 USDCにスワップしようとしています。続行しますか？」）。
* **FR-6 (ストレッチゴール): リミットオーダーの意図**
    * リミットオーダーを作成するための高度なコマンドをサポートします（例：「1 ETHを4000 USDCで売るリミットオーダーを作成して」）。
* **NFR-2: 応答性**
    * ユーザーがコマンドを送信してから7秒以内に、AIの確認応答が表示される必要があります。

## 4. 技術スタック 🛠️

* **フレームワーク:** Next.js (App Router)
* **UIライブラリ:** shadcn/ui
* **ウォレット統合:** wagmi & Viem
* **AIバックエンド:** Next.js API Routesを介したLLM API（例：Gemini API, OpenAI API）
* **デプロイ:** Vercel

## 5. 大まかな開発ロードマップ 🗺️

1.  **フェーズ1: 基盤とポートフォリオビュー（MVP）:** プロジェクトのセットアップ、ウォレット接続の実装、ポートフォリオダッシュボードの構築。
2.  **フェーズ2: バックエンドとLLMの統合:** LLM API用のプロキシを設定。文字列を受け取り、LLMに送信し、構造化されたJSONオブジェクトを取得するロジックを作成。
3.  **フェーズ3: LLMと1inchスワップAPIの接続:** LLMからのJSONオブジェクトを使用して、**Classic Swap**または**Fusion API**を呼び出し、ユーザー確認プロンプトを生成。
4.  **フェーズ4 (ストレッチゴール):** 高度なコマンドのために**Limit Order Protocol API**を実装。
5.  **フェーズ5: 仕上げとデモ準備:** UI/UXの改善、エラーハンドリング、最終プレゼンテーションの準備に集中。

## 6. 1inch APIの依存関係 ✅

1. Balance API

    目的: 特定のウォレットアドレスが保有するトークンとその残高を取得します。

    該当関数: getWalletBalances

    エンドポイント: https://api.1inch.dev/balance/v1.2/{chainId}/balances/{walletAddress}

2. Spot Price API

    目的: 一つ以上のトークンの現在価格をUSDで取得します。

    該当関数: getTokensPrices

    エンドポイント: https://api.1inch.dev/price/v1.1/{chainId}/{address}

3. Token API

    目的: トークンの詳細情報（シンボル、名前、ロゴなど）を取得します。

    該当関数: getTokensInfo

    エンドポイント: https://api.1inch.dev/token/v1.2/{chainId}/custom/{address}

4. Swap API

    目的: トークンスワップの見積もり取得、アプルーブ状況の確認、トランザクションデータの生成など、スワップに関する一連の操作を行います。

    該当関数: getSwapQuote, checkAllowance, getApproveTransaction, getSwapTransactionData

    エンドポイント:

        /swap/v6.1/{chainId}/quote （見積もり取得）

        /swap/v6.1/{chainId}/approve/allowance （アプルーブ状況確認）

        /swap/v6.1/{chainId}/approve/transaction （アプルーブ用データ取得）

        /swap/v6.1/{chainId}/swap （スワップ用データ取得）
